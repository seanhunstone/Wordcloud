{"version":3,"file":"VRKit.module.js","sources":["../src/modules/extra/vr/VREffect.js","../src/modules/extra/node_modules/three-vrcontrols-module/src/vr-controls.js","../src/modules/extra/vr/WebVR.js","../src/modules/extra/VRKit.js"],"sourcesContent":["/**\n * @author dmarcos / https://github.com/dmarcos\n * @author mrdoob / http://mrdoob.com\n *\n * WebVR Spec: http://mozvr.github.io/webvr-spec/webvr.html\n *\n * Firefox: http://mozvr.com/downloads/\n * Chromium: https://webvr.info/get-chrome\n *\n */\n\nexport const VREffect = function ( renderer, onError ) {\n\n\tvar vrDisplay, vrDisplays;\n\tvar eyeTranslationL = new THREE.Vector3();\n\tvar eyeTranslationR = new THREE.Vector3();\n\tvar renderRectL, renderRectR;\n\n\tvar frameData = null;\n\n\tif ( 'VRFrameData' in window ) {\n\n\t\tframeData = new VRFrameData();\n\n\t}\n\n\tfunction gotVRDisplays( displays ) {\n\n\t\tvrDisplays = displays;\n\n\t\tif ( displays.length > 0 ) {\n\n\t\t\tvrDisplay = displays[ 0 ];\n\n\t\t} else {\n\n\t\t\tif ( onError ) onError( 'HMD not available' );\n\n\t\t}\n\n\t}\n\n\tif ( navigator.getVRDisplays ) {\n\n\t\tnavigator.getVRDisplays().then( gotVRDisplays ).catch ( function () {\n\n\t\t\tconsole.warn( 'THREE.VREffect: Unable to get VR Displays' );\n\n\t\t} );\n\n\t}\n\n\t//\n\n\tthis.isPresenting = false;\n\tthis.scale = 1;\n\n\tvar scope = this;\n\n\tvar rendererSize = renderer.getSize();\n\tvar rendererUpdateStyle = false;\n\tvar rendererPixelRatio = renderer.getPixelRatio();\n\n\tthis.getVRDisplay = function () {\n\n\t\treturn vrDisplay;\n\n\t};\n\n\tthis.setVRDisplay = function ( value ) {\n\n\t\tvrDisplay = value;\n\n\t};\n\n\tthis.getVRDisplays = function () {\n\n\t\tconsole.warn( 'THREE.VREffect: getVRDisplays() is being deprecated.' );\n\t\treturn vrDisplays;\n\n\t};\n\n\tthis.setSize = function ( width, height, updateStyle ) {\n\n\t\trendererSize = { width: width, height: height };\n\t\trendererUpdateStyle = updateStyle;\n\n\t\tif ( scope.isPresenting ) {\n\n\t\t\tvar eyeParamsL = vrDisplay.getEyeParameters( 'left' );\n\t\t\trenderer.setPixelRatio( 1 );\n\t\t\trenderer.setSize( eyeParamsL.renderWidth * 2, eyeParamsL.renderHeight, false );\n\n\t\t} else {\n\n\t\t\trenderer.setPixelRatio( rendererPixelRatio );\n\t\t\trenderer.setSize( width, height, updateStyle );\n\n\t\t}\n\n\t};\n\n\t// fullscreen\n\n\tvar canvas = renderer.domElement;\n\tvar requestFullscreen;\n\tvar exitFullscreen;\n\tvar fullscreenElement;\n\tvar defaultLeftBounds = [ 0.0, 0.0, 0.5, 1.0 ];\n\tvar defaultRightBounds = [ 0.5, 0.0, 0.5, 1.0 ];\n\n\tfunction onVRDisplayPresentChange() {\n\n\t\tvar wasPresenting = scope.isPresenting;\n\t\tscope.isPresenting = vrDisplay !== undefined && vrDisplay.isPresenting;\n\n\t\tif ( scope.isPresenting ) {\n\n\t\t\tvar eyeParamsL = vrDisplay.getEyeParameters( 'left' );\n\t\t\tvar eyeWidth = eyeParamsL.renderWidth;\n\t\t\tvar eyeHeight = eyeParamsL.renderHeight;\n\n\t\t\tif ( !wasPresenting ) {\n\n\t\t\t\trendererPixelRatio = renderer.getPixelRatio();\n\t\t\t\trendererSize = renderer.getSize();\n\n\t\t\t\trenderer.setPixelRatio( 1 );\n\t\t\t\trenderer.setSize( eyeWidth * 2, eyeHeight, false );\n\n\t\t\t}\n\n\t\t} else if ( wasPresenting ) {\n\n\t\t\trenderer.setPixelRatio( rendererPixelRatio );\n\t\t\trenderer.setSize( rendererSize.width, rendererSize.height, rendererUpdateStyle );\n\n\t\t}\n\n\t}\n\n\twindow.addEventListener( 'vrdisplaypresentchange', onVRDisplayPresentChange, false );\n\n\tthis.setFullScreen = function ( boolean ) {\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tif ( vrDisplay === undefined ) {\n\n\t\t\t\treject( new Error( 'No VR hardware found.' ) );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( scope.isPresenting === boolean ) {\n\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tif ( boolean ) {\n\n\t\t\t\tresolve( vrDisplay.requestPresent( [ { source: canvas } ] ) );\n\n\t\t\t} else {\n\n\t\t\t\tresolve( vrDisplay.exitPresent() );\n\n\t\t\t}\n\n\t\t} );\n\n\t};\n\n\tthis.requestPresent = function () {\n\n\t\treturn this.setFullScreen( true );\n\n\t};\n\n\tthis.exitPresent = function () {\n\n\t\treturn this.setFullScreen( false );\n\n\t};\n\n\tthis.requestAnimationFrame = function ( f ) {\n\n\t\tif ( vrDisplay !== undefined ) {\n\n\t\t\treturn vrDisplay.requestAnimationFrame( f );\n\n\t\t} else {\n\n\t\t\treturn window.requestAnimationFrame( f );\n\n\t\t}\n\n\t};\n\n\tthis.cancelAnimationFrame = function ( h ) {\n\n\t\tif ( vrDisplay !== undefined ) {\n\n\t\t\tvrDisplay.cancelAnimationFrame( h );\n\n\t\t} else {\n\n\t\t\twindow.cancelAnimationFrame( h );\n\n\t\t}\n\n\t};\n\n\tthis.submitFrame = function () {\n\n\t\tif ( vrDisplay !== undefined && scope.isPresenting ) {\n\n\t\t\tvrDisplay.submitFrame();\n\n\t\t}\n\n\t};\n\n\tthis.autoSubmitFrame = true;\n\n\t// render\n\n\tvar cameraL = new THREE.PerspectiveCamera();\n\tcameraL.layers.enable( 1 );\n\n\tvar cameraR = new THREE.PerspectiveCamera();\n\tcameraR.layers.enable( 2 );\n\n\tthis.render = function ( scene, camera, renderTarget, forceClear ) {\n\n\t\tif ( vrDisplay && scope.isPresenting ) {\n\n\t\t\tvar autoUpdate = scene.autoUpdate;\n\n\t\t\tif ( autoUpdate ) {\n\n\t\t\t\tscene.updateMatrixWorld();\n\t\t\t\tscene.autoUpdate = false;\n\n\t\t\t}\n\n\t\t\tvar eyeParamsL = vrDisplay.getEyeParameters( 'left' );\n\t\t\tvar eyeParamsR = vrDisplay.getEyeParameters( 'right' );\n\n\t\t\teyeTranslationL.fromArray( eyeParamsL.offset );\n\t\t\teyeTranslationR.fromArray( eyeParamsR.offset );\n\n\t\t\tif ( Array.isArray( scene ) ) {\n\n\t\t\t\tconsole.warn( 'THREE.VREffect.render() no longer supports arrays. Use object.layers instead.' );\n\t\t\t\tscene = scene[ 0 ];\n\n\t\t\t}\n\n\t\t\t// When rendering we don't care what the recommended size is, only what the actual size\n\t\t\t// of the backbuffer is.\n\t\t\tvar size = renderer.getSize();\n\t\t\tvar layers = vrDisplay.getLayers();\n\t\t\tvar leftBounds;\n\t\t\tvar rightBounds;\n\n\t\t\tif ( layers.length ) {\n\n\t\t\t\tvar layer = layers[ 0 ];\n\n\t\t\t\tleftBounds = layer.leftBounds !== null && layer.leftBounds.length === 4 ? layer.leftBounds : defaultLeftBounds;\n\t\t\t\trightBounds = layer.rightBounds !== null && layer.rightBounds.length === 4 ? layer.rightBounds : defaultRightBounds;\n\n\t\t\t} else {\n\n\t\t\t\tleftBounds = defaultLeftBounds;\n\t\t\t\trightBounds = defaultRightBounds;\n\n\t\t\t}\n\n\t\t\trenderRectL = {\n\t\t\t\tx: Math.round( size.width * leftBounds[ 0 ] ),\n\t\t\t\ty: Math.round( size.height * leftBounds[ 1 ] ),\n\t\t\t\twidth: Math.round( size.width * leftBounds[ 2 ] ),\n\t\t\t\theight: Math.round(size.height * leftBounds[ 3 ] )\n\t\t\t};\n\t\t\trenderRectR = {\n\t\t\t\tx: Math.round( size.width * rightBounds[ 0 ] ),\n\t\t\t\ty: Math.round( size.height * rightBounds[ 1 ] ),\n\t\t\t\twidth: Math.round( size.width * rightBounds[ 2 ] ),\n\t\t\t\theight: Math.round(size.height * rightBounds[ 3 ] )\n\t\t\t};\n\n\t\t\tif ( renderTarget ) {\n\n\t\t\t\trenderer.setRenderTarget( renderTarget );\n\t\t\t\trenderTarget.scissorTest = true;\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setRenderTarget( null );\n\t\t\t\trenderer.setScissorTest( true );\n\n\t\t\t}\n\n\t\t\tif ( renderer.autoClear || forceClear ) renderer.clear();\n\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\t\tcamera.matrixWorld.decompose( cameraL.position, cameraL.quaternion, cameraL.scale );\n\t\t\tcamera.matrixWorld.decompose( cameraR.position, cameraR.quaternion, cameraR.scale );\n\n\t\t\tvar scale = this.scale;\n\t\t\tcameraL.translateOnAxis( eyeTranslationL, scale );\n\t\t\tcameraR.translateOnAxis( eyeTranslationR, scale );\n\n\t\t\tif ( vrDisplay.getFrameData ) {\n\n\t\t\t\tvrDisplay.depthNear = camera.near;\n\t\t\t\tvrDisplay.depthFar = camera.far;\n\n\t\t\t\tvrDisplay.getFrameData( frameData );\n\n\t\t\t\tcameraL.projectionMatrix.elements = frameData.leftProjectionMatrix;\n\t\t\t\tcameraR.projectionMatrix.elements = frameData.rightProjectionMatrix;\n\n\t\t\t} else {\n\n\t\t\t\tcameraL.projectionMatrix = fovToProjection( eyeParamsL.fieldOfView, true, camera.near, camera.far );\n\t\t\t\tcameraR.projectionMatrix = fovToProjection( eyeParamsR.fieldOfView, true, camera.near, camera.far );\n\n\t\t\t}\n\n\t\t\t// render left eye\n\t\t\tif ( renderTarget ) {\n\n\t\t\t\trenderTarget.viewport.set( renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height );\n\t\t\t\trenderTarget.scissor.set( renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height );\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setViewport( renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height );\n\t\t\t\trenderer.setScissor( renderRectL.x, renderRectL.y, renderRectL.width, renderRectL.height );\n\n\t\t\t}\n\t\t\trenderer.render( scene, cameraL, renderTarget, forceClear );\n\n\t\t\t// render right eye\n\t\t\tif ( renderTarget ) {\n\n\t\t\t\trenderTarget.viewport.set( renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height );\n\t\t\t\trenderTarget.scissor.set( renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height );\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setViewport( renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height );\n\t\t\t\trenderer.setScissor( renderRectR.x, renderRectR.y, renderRectR.width, renderRectR.height );\n\n\t\t\t}\n\t\t\trenderer.render( scene, cameraR, renderTarget, forceClear );\n\n\t\t\tif ( renderTarget ) {\n\n\t\t\t\trenderTarget.viewport.set( 0, 0, size.width, size.height );\n\t\t\t\trenderTarget.scissor.set( 0, 0, size.width, size.height );\n\t\t\t\trenderTarget.scissorTest = false;\n\t\t\t\trenderer.setRenderTarget( null );\n\n\t\t\t} else {\n\n\t\t\t\trenderer.setViewport( 0, 0, size.width, size.height );\n\t\t\t\trenderer.setScissorTest( false );\n\n\t\t\t}\n\n\t\t\tif ( autoUpdate ) {\n\n\t\t\t\tscene.autoUpdate = true;\n\n\t\t\t}\n\n\t\t\tif ( scope.autoSubmitFrame ) {\n\n\t\t\t\tscope.submitFrame();\n\n\t\t\t}\n\n\t\t\treturn;\n\n\t\t}\n\n\t\t// Regular render mode if not HMD\n\n\t\trenderer.render( scene, camera, renderTarget, forceClear );\n\n\t};\n\n\tthis.dispose = function () {\n\n\t\twindow.removeEventListener( 'vrdisplaypresentchange', onVRDisplayPresentChange, false );\n\n\t};\n\n\t//\n\n\tfunction fovToNDCScaleOffset( fov ) {\n\n\t\tvar pxscale = 2.0 / ( fov.leftTan + fov.rightTan );\n\t\tvar pxoffset = ( fov.leftTan - fov.rightTan ) * pxscale * 0.5;\n\t\tvar pyscale = 2.0 / ( fov.upTan + fov.downTan );\n\t\tvar pyoffset = ( fov.upTan - fov.downTan ) * pyscale * 0.5;\n\t\treturn { scale: [ pxscale, pyscale ], offset: [ pxoffset, pyoffset ] };\n\n\t}\n\n\tfunction fovPortToProjection( fov, rightHanded, zNear, zFar ) {\n\n\t\trightHanded = rightHanded === undefined ? true : rightHanded;\n\t\tzNear = zNear === undefined ? 0.01 : zNear;\n\t\tzFar = zFar === undefined ? 10000.0 : zFar;\n\n\t\tvar handednessScale = rightHanded ? - 1.0 : 1.0;\n\n\t\t// start with an identity matrix\n\t\tvar mobj = new THREE.Matrix4();\n\t\tvar m = mobj.elements;\n\n\t\t// and with scale/offset info for normalized device coords\n\t\tvar scaleAndOffset = fovToNDCScaleOffset( fov );\n\n\t\t// X result, map clip edges to [-w,+w]\n\t\tm[ 0 * 4 + 0 ] = scaleAndOffset.scale[ 0 ];\n\t\tm[ 0 * 4 + 1 ] = 0.0;\n\t\tm[ 0 * 4 + 2 ] = scaleAndOffset.offset[ 0 ] * handednessScale;\n\t\tm[ 0 * 4 + 3 ] = 0.0;\n\n\t\t// Y result, map clip edges to [-w,+w]\n\t\t// Y offset is negated because this proj matrix transforms from world coords with Y=up,\n\t\t// but the NDC scaling has Y=down (thanks D3D?)\n\t\tm[ 1 * 4 + 0 ] = 0.0;\n\t\tm[ 1 * 4 + 1 ] = scaleAndOffset.scale[ 1 ];\n\t\tm[ 1 * 4 + 2 ] = - scaleAndOffset.offset[ 1 ] * handednessScale;\n\t\tm[ 1 * 4 + 3 ] = 0.0;\n\n\t\t// Z result (up to the app)\n\t\tm[ 2 * 4 + 0 ] = 0.0;\n\t\tm[ 2 * 4 + 1 ] = 0.0;\n\t\tm[ 2 * 4 + 2 ] = zFar / ( zNear - zFar ) * - handednessScale;\n\t\tm[ 2 * 4 + 3 ] = ( zFar * zNear ) / ( zNear - zFar );\n\n\t\t// W result (= Z in)\n\t\tm[ 3 * 4 + 0 ] = 0.0;\n\t\tm[ 3 * 4 + 1 ] = 0.0;\n\t\tm[ 3 * 4 + 2 ] = handednessScale;\n\t\tm[ 3 * 4 + 3 ] = 0.0;\n\n\t\tmobj.transpose();\n\n\t\treturn mobj;\n\n\t}\n\n\tfunction fovToProjection( fov, rightHanded, zNear, zFar ) {\n\n\t\tvar DEG2RAD = Math.PI / 180.0;\n\n\t\tvar fovPort = {\n\t\t\tupTan: Math.tan( fov.upDegrees * DEG2RAD ),\n\t\t\tdownTan: Math.tan( fov.downDegrees * DEG2RAD ),\n\t\t\tleftTan: Math.tan( fov.leftDegrees * DEG2RAD ),\n\t\t\trightTan: Math.tan( fov.rightDegrees * DEG2RAD )\n\t\t};\n\n\t\treturn fovPortToProjection( fovPort, rightHanded, zNear, zFar );\n\n\t}\n\n};\n","import {Matrix4} from 'three';\n\n    /**\n * @author dmarcos / https://github.com/dmarcos\n * @author mrdoob / http://mrdoob.com\n * @author halvves / https://github.com/halvves (i only es6 moduled it)\n */\n\nexport default class VRControls {\n  constructor(camera, onError) {\n    this.camera = camera;\n    this.vrDisplay;\n    this.vrDisplays;\n    this.standingMatrix = new Matrix4();\n    this.frameData = null;\n\n    if ('VRFrameData' in window) {\n      this.frameData = new VRFrameData();\n    }\n\n    if (navigator.getVRDisplays) {\n      navigator\n        .getVRDisplays()\n        .then((displays) => {\n          this.vrDisplays = displays;\n          if (displays.length > 0) {\n            this.vrDisplay = displays[0];\n          } else {\n            if (onError) onError('VR input not available.');\n          }\n        })\n        .catch(() => {\n          console.warn('VRControls: Unable to get VR Displays');\n        });\n    }\n\n    // the Rift SDK returns the position in meters\n    // this scale factor allows the user to define how meters\n    // are converted to scene units.\n    this.scale = 1;\n\n    // If true will use \"standing space\" coordinate system where y=0 is the\n    // floor and x=0, z=0 is the center of the room.\n    this.standing = false;\n\n    // Distance from the users eyes to the floor in meters. Used when\n    // standing=true but the VRDisplay doesn't provide stageParameters.\n    this.userHeight = 1.6;\n  }\n\n  getVRDisplay() {\n    return this.vrDisplay;\n  };\n\n  setVRDisplay(value) {\n    this.vrDisplay = value;\n  };\n\n  getVRDisplays() {\n    console.warn('VRControls: getVRDisplays() is being deprecated.');\n    return this.vrDisplays;\n  };\n\n  getStandingMatrix() {\n    return this.standingMatrix;\n  };\n\n  update() {\n    const camera = this.camera;\n\n    if (this.vrDisplay) {\n      let pose;\n      if (this.vrDisplay.getFrameData) {\n        this.vrDisplay.getFrameData(this.frameData);\n        pose = this.frameData.pose;\n      } else if (this.vrDisplay.getPose) {\n        pose = this.vrDisplay.getPose();\n      }\n      if (pose.orientation !== null) {\n        camera.quaternion.fromArray(pose.orientation);\n      }\n      if (pose.position !== null) {\n        camera.position.fromArray(pose.position);\n      } else {\n        camera.position.set(0, 0, 0);\n      }\n      if (this.standing) {\n        if (this.vrDisplay.stageParameters) {\n          camera.updateMatrix();\n          this.standingMatrix.fromArray(this.vrDisplay.stageParameters.sittingToStandingTransform);\n          camera.applyMatrix(this.standingMatrix);\n        } else {\n          camera.position.setY(camera.position.y + this.userHeight);\n        }\n      }\n      camera.position.multiplyScalar(this.scale);\n    }\n  };\n\n  dispose() {\n    this.vrDisplay = null;\n  };\n};\n","/**\n * @author mrdoob / http://mrdoob.com\n * @author Mugen87 / https://github.com/Mugen87\n *\n * Based on @tojiro's vr-samples-utils.js\n */\n\nexport const WEBVR = {\n\n\tisAvailable: function () {\n\n\t\tconsole.warn( 'WEBVR: isAvailable() is being deprecated. Use .checkAvailability() instead.' );\n\t\treturn navigator.getVRDisplays !== undefined;\n\n\t},\n\n\tcheckAvailability: function () {\n\n\t\treturn new Promise( function( resolve, reject ) {\n\n\t\t\tif ( navigator.getVRDisplays !== undefined ) {\n\n\t\t\t\tnavigator.getVRDisplays().then( function ( displays ) {\n\n\t\t\t\t\tif ( displays.length === 0 ) {\n\n\t\t\t\t\t\treject( 'WebVR supported, but no VRDisplays found.' );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tresolve();\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t} else {\n\n\t\t\t\treject( 'Your browser does not support WebVR. See <a href=\"https://webvr.info\">webvr.info</a> for assistance.' );\n\n\t\t\t}\n\n\t\t} );\n\n\t},\n\n\tgetVRDisplay: function ( onDisplay ) {\n\n\t\tif ( 'getVRDisplays' in navigator ) {\n\n\t\t\tnavigator.getVRDisplays()\n\t\t\t\t.then( function ( displays ) {\n\t\t\t\t\tonDisplay( displays[ 0 ] );\n\t\t\t\t} );\n\n\t\t}\n\n\t},\n\n\tgetMessage: function () {\n\n\t\tconsole.warn( 'WEBVR: getMessage() is being deprecated. Use .getMessageContainer( message ) instead.' );\n\n\t\tvar message;\n\n\t\tif ( navigator.getVRDisplays ) {\n\n\t\t\tnavigator.getVRDisplays().then( function ( displays ) {\n\n\t\t\t\tif ( displays.length === 0 ) message = 'WebVR supported, but no VRDisplays found.';\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\tmessage = 'Your browser does not support WebVR. See <a href=\"http://webvr.info\">webvr.info</a> for assistance.';\n\n\t\t}\n\n\t\tif ( message !== undefined ) {\n\n\t\t\tvar container = document.createElement( 'div' );\n\t\t\tcontainer.style.position = 'absolute';\n\t\t\tcontainer.style.left = '0';\n\t\t\tcontainer.style.top = '0';\n\t\t\tcontainer.style.right = '0';\n\t\t\tcontainer.style.zIndex = '999';\n\t\t\tcontainer.align = 'center';\n\n\t\t\tvar error = document.createElement( 'div' );\n\t\t\terror.style.fontFamily = 'sans-serif';\n\t\t\terror.style.fontSize = '16px';\n\t\t\terror.style.fontStyle = 'normal';\n\t\t\terror.style.lineHeight = '26px';\n\t\t\terror.style.backgroundColor = '#fff';\n\t\t\terror.style.color = '#000';\n\t\t\terror.style.padding = '10px 20px';\n\t\t\terror.style.margin = '50px';\n\t\t\terror.style.display = 'inline-block';\n\t\t\terror.innerHTML = message;\n\t\t\tcontainer.appendChild( error );\n\n\t\t\treturn container;\n\n\t\t}\n\n\t},\n\n\tgetMessageContainer: function ( message ) {\n\n\t\tvar container = document.createElement( 'div' );\n\t\tcontainer.style.position = 'absolute';\n\t\tcontainer.style.left = '0';\n\t\tcontainer.style.top = '0';\n\t\tcontainer.style.right = '0';\n\t\tcontainer.style.zIndex = '999';\n\t\tcontainer.align = 'center';\n\n\t\tvar error = document.createElement( 'div' );\n\t\terror.style.fontFamily = 'sans-serif';\n\t\terror.style.fontSize = '16px';\n\t\terror.style.fontStyle = 'normal';\n\t\terror.style.lineHeight = '26px';\n\t\terror.style.backgroundColor = '#fff';\n\t\terror.style.color = '#000';\n\t\terror.style.padding = '10px 20px';\n\t\terror.style.margin = '50px';\n\t\terror.style.display = 'inline-block';\n\t\terror.innerHTML = message;\n\t\tcontainer.appendChild( error );\n\n\t\treturn container;\n\n\t},\n\n\tgetButton: function ( display, canvas ) {\n\n\t\tif ( 'VREffect' in THREE && display instanceof THREE.VREffect ) {\n\n\t\t\tconsole.error( 'WebVR.getButton() now expects a VRDisplay.' );\n\t\t\treturn document.createElement( 'button' );\n\n\t\t}\n\n\t\tvar button = document.createElement( 'button' );\n\t\tbutton.style.position = 'absolute';\n\t\tbutton.style.left = 'calc(50% - 50px)';\n\t\tbutton.style.bottom = '20px';\n\t\tbutton.style.width = '100px';\n\t\tbutton.style.border = '0';\n\t\tbutton.style.padding = '8px';\n\t\tbutton.style.cursor = 'pointer';\n\t\tbutton.style.backgroundColor = '#000';\n\t\tbutton.style.color = '#fff';\n\t\tbutton.style.fontFamily = 'sans-serif';\n\t\tbutton.style.fontSize = '13px';\n\t\tbutton.style.fontStyle = 'normal';\n\t\tbutton.style.textAlign = 'center';\n\t\tbutton.style.zIndex = '999';\n\n\t\tif ( display ) {\n\n\t\t\tbutton.textContent = 'ENTER VR';\n\t\t\tbutton.onclick = function () {\n\n\t\t\t\tdisplay.isPresenting ? display.exitPresent() : display.requestPresent( [ { source: canvas } ] );\n\n\t\t\t};\n\n\t\t\twindow.addEventListener( 'vrdisplaypresentchange', function () {\n\n\t\t\t\tbutton.textContent = display.isPresenting ? 'EXIT VR' : 'ENTER VR';\n\n\t\t\t}, false );\n\n\t\t} else {\n\n\t\t\tbutton.textContent = 'NO VR DISPLAY';\n\n\t\t}\n\n\t\treturn button;\n\n\t}\n\n};\n","import {Loop, ControlsModule, CameraComponent} from 'whs';\nimport {REVISION} from 'three';\n\nimport {VREffect} from './vr/VREffect';\nimport VRControlsNative from 'three-vrcontrols-module';\nimport {WEBVR} from './vr/WebVR';\n\nexport class VRModule {\n  constructor(params = {}) {\n    this.params = Object.assign(params, {\n      message: true,\n      button: true\n    });\n\n    this.scene = null;\n    this.camera = null;\n    this.effect = null;\n  }\n\n  manager(manager) {\n    manager.define('vr');\n\n    if (REVISION > 86) console.warn('Please use VRModule2 for Three.js ^0.87.0 (r87)');\n\n    const rendering = manager.use('rendering');\n    const renderer = manager.get('renderer');\n\n    const resize = manager.use('resize');\n\n    this.effect = new VREffect(renderer);\n\n    this.scene = manager.get('scene');\n    this.camera = manager.get('camera');\n\n    rendering.effect(this.effect);\n\n    // TODO: Fix resize.\n\n    resize.addCallback((width, height) => {\n      this.effect.setSize(+width, +height);\n    });\n\n    // WEBVR\n    const {message, button} = this.params;\n\n    if (message) WEBVR.checkAvailability().catch(message => {\n\t\t\tdocument.body.appendChild(WEBVR.getMessageContainer(message));\n\t\t});\n\n    if (button) WEBVR.getVRDisplay(display => {\n      document.body.appendChild(WEBVR.getButton(display, renderer.domElement));\n    });\n  }\n}\n\nexport class VR2Module {\n  constructor() {\n    this.display = new Promise(resolve => WEBVR.getVRDisplay(display => resolve(display)));\n  }\n\n  manager(manager) {\n    manager.define('vr');\n\n    const renderer = manager.get('renderer');\n    renderer.vr.enabled = true;\n    console.log(REVISION);\n\n    this.display.then(display => {\n      renderer.vr.setDevice(display);\n\n      document.body.appendChild(WEBVR.getButton(display, renderer.domElement));\n    });\n  }\n}\n\nexport class VRControls extends ControlsModule {\n  constructor({object, onError, intensity}) {\n    const controls = new VRControlsNative(object.native, onError);\n\n    controls.standing = true;\n    controls.scale = intensity;\n\n    super({controls});\n  }\n}\n"],"names":["VREffect","renderer","onError","vrDisplay","vrDisplays","eyeTranslationL","THREE","Vector3","eyeTranslationR","renderRectL","renderRectR","frameData","window","VRFrameData","gotVRDisplays","displays","length","navigator","getVRDisplays","then","catch","warn","isPresenting","scale","scope","rendererSize","getSize","rendererUpdateStyle","rendererPixelRatio","getPixelRatio","getVRDisplay","setVRDisplay","value","setSize","width","height","updateStyle","eyeParamsL","getEyeParameters","setPixelRatio","renderWidth","renderHeight","canvas","domElement","requestFullscreen","exitFullscreen","fullscreenElement","defaultLeftBounds","defaultRightBounds","onVRDisplayPresentChange","wasPresenting","undefined","eyeWidth","eyeHeight","addEventListener","setFullScreen","boolean","Promise","resolve","reject","Error","requestPresent","source","exitPresent","requestAnimationFrame","f","cancelAnimationFrame","h","submitFrame","autoSubmitFrame","cameraL","PerspectiveCamera","layers","enable","cameraR","render","scene","camera","renderTarget","forceClear","autoUpdate","updateMatrixWorld","eyeParamsR","fromArray","offset","Array","isArray","size","getLayers","leftBounds","rightBounds","layer","Math","round","setRenderTarget","scissorTest","setScissorTest","autoClear","clear","parent","matrixWorld","decompose","position","quaternion","translateOnAxis","getFrameData","depthNear","near","depthFar","far","projectionMatrix","elements","leftProjectionMatrix","rightProjectionMatrix","fovToProjection","fieldOfView","viewport","set","x","y","scissor","setViewport","setScissor","dispose","removeEventListener","fovToNDCScaleOffset","fov","pxscale","leftTan","rightTan","pxoffset","pyscale","upTan","downTan","pyoffset","fovPortToProjection","rightHanded","zNear","zFar","handednessScale","mobj","Matrix4","m","scaleAndOffset","transpose","DEG2RAD","PI","fovPort","tan","upDegrees","downDegrees","leftDegrees","rightDegrees","VRControls","WEBVR","onDisplay","message","container","document","createElement","style","left","top","right","zIndex","align","error","fontFamily","fontSize","fontStyle","lineHeight","backgroundColor","color","padding","margin","display","innerHTML","appendChild","button","bottom","border","cursor","textAlign","textContent","onclick","VRModule","params","Object","assign","effect","manager","define","REVISION","console","rendering","use","get","resize","addCallback","checkAvailability","body","getMessageContainer","getButton","VR2Module","vr","enabled","log","setDevice","object","intensity","controls","VRControlsNative","native","standing","ControlsModule"],"mappings":"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"}