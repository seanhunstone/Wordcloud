{"version":3,"file":"PerformanceModule.module.js","sources":["../src/modules/extra/node_modules/inherits/inherits.js","../src/modules/extra/node_modules/fps/index.js","../src/modules/extra/node_modules/minivents/dist/minivents.commonjs.js","../src/modules/extra/PerformanceModule.js"],"sourcesContent":["module.exports = inherits\n\nfunction inherits (c, p, proto) {\n  proto = proto || {}\n  var e = {}\n  ;[c.prototype, proto].forEach(function (s) {\n    Object.getOwnPropertyNames(s).forEach(function (k) {\n      e[k] = Object.getOwnPropertyDescriptor(s, k)\n    })\n  })\n  c.prototype = Object.create(p.prototype, e)\n  c.super = p\n}\n\n//function Child () {\n//  Child.super.call(this)\n//  console.error([this\n//                ,this.constructor\n//                ,this.constructor === Child\n//                ,this.constructor.super === Parent\n//                ,Object.getPrototypeOf(this) === Child.prototype\n//                ,Object.getPrototypeOf(Object.getPrototypeOf(this))\n//                 === Parent.prototype\n//                ,this instanceof Child\n//                ,this instanceof Parent])\n//}\n//function Parent () {}\n//inherits(Child, Parent)\n//new Child\n","var EventEmitter = require('events').EventEmitter\n  , inherits = require('inherits')\n\nmodule.exports = fps\n\n// Try use performance.now(), otherwise try\n// +new Date.\nvar now = (\n  (function(){ return this }()).performance &&\n  'function' === typeof performance.now\n) ? function() { return performance.now() }\n  : Date.now || function() { return +new Date }\n\nfunction fps(opts) {\n  if (!(this instanceof fps)) return new fps(opts)\n  EventEmitter.call(this)\n\n  opts = opts || {}\n  this.last = now()\n  this.rate = 0\n  this.time = 0\n  this.decay = opts.decay || 1\n  this.every = opts.every || 1\n  this.ticks = 0\n}\ninherits(fps, EventEmitter)\n\nfps.prototype.tick = function() {\n  var time = now()\n    , diff = time - this.last\n    , fps = diff\n\n  this.ticks += 1\n  this.last = time\n  this.time += (fps - this.time) * this.decay\n  this.rate = 1000 / this.time\n  if (!(this.ticks % this.every)) this.emit('data', this.rate)\n}\n\n","module.exports = function Events(target){\n  var events = {}, empty = [];\n  target = target || this\n  /**\n   *  On: listen to events\n   */\n  target.on = function(type, func, ctx){\n    (events[type] = events[type] || []).push([func, ctx])\n  }\n  /**\n   *  Off: stop listening to event / specific callback\n   */\n  target.off = function(type, func){\n    type || (events = {})\n    var list = events[type] || empty,\n        i = list.length = func ? list.length : 0;\n    while(i--) func == list[i][0] && list.splice(i,1)\n  }\n  /** \n   * Emit: send event, callbacks will be triggered\n   */\n  target.emit = function(type){\n    var e = events[type] || empty, list = e.length > 0 ? e.slice(0, e.length) : e, i=0, j;\n    while(j=list[i++]) j[0].apply(j[1], empty.slice.call(arguments, 1))\n  };\n};","import fps from 'fps';\nimport Events from 'minivents';\n\nexport default class PerformanceModule extends Events {\n  constructor(config, iterationStart = 60, framesToUpdate = 60, blockTimeout = 0) {\n    super();\n\n    this.config = config;\n    this.enabled = {};\n    this.iterationStart = iterationStart;\n    this.framesToUpdate = framesToUpdate;\n    this.blockTimeout = blockTimeout;\n    this.iteration = 0;\n    this.avgRate = 60;\n    this.block = false;\n\n    for (const key in config)\n      if (config[key]) this.enabled[key] = true;\n\n    this.ticker = fps();\n    this.rate = 60;\n  }\n\n  manager(manager) {\n    manager.define('performance');\n    const {ticker, config} = this;\n\n    this.app = manager.handler;\n\n    this.loop = new WHS.Loop(() => {\n      ticker.tick();\n      this.rate = ticker.rate;\n\n      this.avgRate = (this.iteration * this.avgRate + this.rate) / (this.iteration + 1);\n\n      if (this.iteration % this.framesToUpdate === 0 && this.iteration > this.iterationStart && !this.block) {\n        for (const key in config) {\n          if (config[key]) {\n            const erate = config[key];\n\n            this.enable(key);\n\n            if (this.enabled[key] && erate > this.avgRate) {\n              this.disable(key);\n              this.block = true;\n              this.iteration = 1;\n              this.avgRate = 60;\n\n              setTimeout(() => {\n                this.block = false;\n              }, this.blockTimeout);\n\n              delete config[key];\n            }\n\n            break;\n          }\n        }\n      }\n\n      this.iteration++;\n    });\n  }\n\n  start() {\n    this.loop.start(this.app);\n  }\n\n  disable(key) {\n    this.enabled[key] = false;\n    this.emit(key, false);\n  }\n\n  enable(key) {\n    this.enabled[key] = true;\n    this.emit(key, true);\n  }\n}\n"],"names":["require$$0","inherits","events","PerformanceModule","config","iterationStart","framesToUpdate","blockTimeout","enabled","iteration","avgRate","block","key","ticker","fps","rate","manager","define","app","handler","loop","WHS","Loop","tick","erate","enable","disable","start","emit","Events"],"mappings":"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"}